DROP TABLE IF EXISTS food_item;
DROP TABLE IF EXISTS food_log;
DROP TABLE IF EXISTS weight_log;
DROP TABLE IF EXISTS exercise_log;
DROP TABLE IF EXISTS user CASCADE;

CREATE TABLE user (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	first_name VARCHAR(32),
	last_name VARCHAR(32),
	date_of_birth DATE,
	date_joined TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	avatar VARCHAR(128) NOT NULL DEFAULT "",
	username VARCHAR(32) NOT NULL UNIQUE,
	password VARCHAR(32) NOT NULL,
	email VARCHAR(32) NOT NULL UNIQUE,
	activated TINYINT DEFAULT 0,
        monthly_diet_quota INT UNSIGNED DEFAULT 0,
        monthly_exercise_quota INT UNSIGNED DEFAULT 0
);

CREATE TABLE food_item (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	display_name VARCHAR(32) NOT NULL,
	serving_size_count DOUBLE(5,2) DEFAULT 0.00,
	serving_size_weight TINYINT DEFAULT 0,
	calories INT UNSIGNED DEFAULT 0,
	fat_calories INT UNSIGNED DEFAULT 0,
	protein INT UNSIGNED DEFAULT 0
);

CREATE TABLE food_log (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	user_id INT UNSIGNED NOT NULL,
	food_ids_list VARCHAR(128),
	calories INT UNSIGNED DEFAULT 0,
	comment VARCHAR(256),
	date_logged TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE
);

CREATE TABLE weight_log (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	user_id INT UNSIGNED NOT NULL,
	weight INT UNSIGNED NOT NULL,
	comment VARCHAR(256),
	date_logged TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE
);

CREATE TABLE exercise_log (
	id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY,
	user_id INT UNSIGNED NOT NULL,
	duration INT UNSIGNED DEFAULT 0,
	type VARCHAR(128),
	calories INT UNSIGNED DEFAULT 0,
	comment VARCHAR(256),
	date_logged TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE CASCADE
);

CREATE INDEX i_user_id ON user(id);
CREATE INDEX i_food_log_user_id ON food_log(user_id);
CREATE INDEX i_weight_log_user_id ON weight_log(user_id);
CREATE INDEX i_exercise_log_user_id ON exercise_log(user_id);

INSERT INTO user VALUES(NULL, "Ron", "Rider", "01-23-1989", NULL, "", "rideron89", "N64vto2g", "rideron89@gmail.com", 0, 75000, 75000);
INSERT INTO food_log VALUES(NULL, 1, "", 280, "first test entry", NULL);
INSERT INTO food_log VALUES(NULL, 1, "", 570, "second test entry", NULL);
INSERT INTO food_log VALUES(NULL, 1, "", 350, "third test entry", "1970-01-01 00:00:01");
INSERT INTO exercise_log VALUES(NULL, 1, 30, "", 120, "first test entry", NULL);
INSERT INTO exercise_log VALUES(NULL, 1, 45, "", 210, "second test entry", NULL);
INSERT INTO exercise_log VALUES(NULL, 1, 60, "", 315, "third test entry", "1970-01-01 00:00:01");
